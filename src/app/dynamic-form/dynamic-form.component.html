@if (formConfig()) {
  <div class="dynamic-form-container">
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>{{ formConfig().name }}</mat-card-title>
      </mat-card-header>
      
      @if (dynamicForm()) {
        <mat-card-content>
          <form [formGroup]="dynamicForm()!" (ngSubmit)="onSubmit()" class="dynamic-form">
            @for (field of formConfig().fields; track field.name) {
              <div 
                class="form-field"
                [class.field-error]="isFieldInvalid(field.name)">
                
                <!-- Dynamic Field Component using ngComponentOutlet -->
                @if (getFieldComponentType(field); as componentType) {
                  <ng-container
                    [ngComponentOutlet]="componentType"
                    [ngComponentOutletInputs]="{
                      field: field,
                      formGroup: dynamicForm()!,
                      isInvalid: isFieldInvalid(field.name),
                      formId: formId
                    }">
                  </ng-container>
                }

                <!-- Error Message -->
                @if (isFieldInvalid(field.name)) {
                  <div
                    [id]="formId + '-' + field.name + '-error'"
                    class="error-message"
                    role="alert">
                    {{ getFieldError(field.name) }}
                  </div>
                }
              </div>
            }

            <mat-divider class="form-divider"></mat-divider>

            <div class="form-actions">
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="!isFormValid()">
                Submit
              </button>
              <button
                mat-button
                type="button"
                (click)="resetForm()">
                Reset
              </button>
            </div>
          </form>
        </mat-card-content>

        <!-- Form Data Display (for debugging/demo) -->
        @if (hasFormData()) {
          <mat-divider></mat-divider>
          <mat-card-content>
            <div class="form-data-display">
              <h3>Form Data:</h3>
              <pre>{{ formData() | json }}</pre>
            </div>
          </mat-card-content>
        }
      }
    </mat-card>
  </div>
}

@if (!formConfig()) {
  <div class="no-config">
    <mat-card>
      <mat-card-content>
        <p>No form configuration provided.</p>
      </mat-card-content>
    </mat-card>
  </div>
}
