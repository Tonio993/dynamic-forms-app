@if (formConfig()) {
  <div class="dynamic-form-container">
    <h2 class="form-title">{{ formConfig().name }}</h2>
    
    @if (dynamicForm()) {
      <form [formGroup]="dynamicForm()!" (ngSubmit)="onSubmit()" class="dynamic-form">
        @for (field of formConfig().fields; track field.name) {
          <div 
            class="form-field"
            [class.field-error]="isFieldInvalid(field.name)">
            
            <label [for]="field.name" class="field-label">
              {{ getFieldLabel(field) }}
              @if (field.required) {
                <span class="required-indicator">*</span>
              }
            </label>

            <!-- Text Input -->
            @if (field.type === 'text') {
              <input
                [id]="field.name"
                [formControlName]="field.name"
                type="text"
                [placeholder]="field.placeholder || ''"
                class="form-control"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null">
            }

            <!-- Number Input -->
            @if (field.type === 'number') {
              <input
                [id]="field.name"
                [formControlName]="field.name"
                type="number"
                [placeholder]="field.placeholder || ''"
                class="form-control"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null">
            }

            <!-- Email Input -->
            @if (field.type === 'email') {
              <input
                [id]="field.name"
                [formControlName]="field.name"
                type="email"
                [placeholder]="field.placeholder || ''"
                class="form-control"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null">
            }

            <!-- Password Input -->
            @if (field.type === 'password') {
              <input
                [id]="field.name"
                [formControlName]="field.name"
                type="password"
                [placeholder]="field.placeholder || ''"
                class="form-control"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null">
            }

            <!-- Date Input -->
            @if (field.type === 'date') {
              <input
                [id]="field.name"
                [formControlName]="field.name"
                type="date"
                class="form-control"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null">
            }

            <!-- Textarea -->
            @if (field.type === 'textarea') {
              <textarea
                [id]="field.name"
                [formControlName]="field.name"
                [placeholder]="field.placeholder || ''"
                class="form-control textarea-control"
                rows="4"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null"></textarea>
            }

            <!-- Select Dropdown -->
            @if (field.type === 'select' && field.options) {
              <select
                [id]="field.name"
                [formControlName]="field.name"
                class="form-control"
                [class.error]="isFieldInvalid(field.name)"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)"
                [attr.aria-describedby]="isFieldInvalid(field.name) ? field.name + '-error' : null">
                <option value="" disabled>Select an option</option>
                @for (option of field.options; track option) {
                  <option [value]="option">
                    {{ option }}
                  </option>
                }
              </select>
            }

            <!-- Radio Buttons -->
            @if (field.type === 'radio' && field.options) {
              <div
                class="radio-group"
                [attr.aria-required]="field.required"
                [attr.aria-invalid]="isFieldInvalid(field.name)">
                @for (option of field.options; track option) {
                  <label class="radio-option">
                    <input
                      type="radio"
                      [formControlName]="field.name"
                      [value]="option"
                      [id]="field.name + '-' + option">
                    <span>{{ option }}</span>
                  </label>
                }
              </div>
            }

            <!-- Checkbox -->
            @if (field.type === 'checkbox') {
              <div class="checkbox-group">
                <label class="checkbox-option">
                  <input
                    type="checkbox"
                    [formControlName]="field.name"
                    [id]="field.name">
                  <span>{{ field.placeholder || 'Check this box' }}</span>
                </label>
              </div>
            }

            <!-- Error Message -->
            @if (isFieldInvalid(field.name)) {
              <div
                [id]="field.name + '-error'"
                class="error-message"
                role="alert">
                {{ getFieldError(field.name) }}
              </div>
            }
          </div>
        }

        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="!isFormValid()">
            Submit
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="resetForm()">
            Reset
          </button>
        </div>
      </form>

      <!-- Form Data Display (for debugging/demo) -->
      @if (hasFormData()) {
        <div class="form-data-display">
          <h3>Form Data:</h3>
          <pre>{{ formData() | json }}</pre>
        </div>
      }
    }
  </div>
}

@if (!formConfig()) {
  <div class="no-config">
    <p>No form configuration provided.</p>
  </div>
}
